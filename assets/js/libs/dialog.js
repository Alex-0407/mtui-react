/*! Dialog v1.8 | haovei@qq.com */
define(function(require,a){var b=require("libs/jquery"),c=function(a,b,c){var d=new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+a.replace(/[\r\t\n]/g," ").split("<#").join("	").replace(/((^|#>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)#>/g,"',$1,'").split("	").join("');").split("#>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"),e=b?d(b):d;return void 0!==c&&c(),e},d=function(a){var d={ID:"mydialog",title:"",content:"",data:"",width:0,heigth:0,closeFn:null,openFn:null,submitFn:null,submitSuccessFn:null,submitErrorFn:null,htmlContent:"",iframeSrc:"",isIE6:"undefined"==typeof document.body.style.maxHeight,isMask:!0,follow:!1,hasClose:!0,dialogClass:"",_dialogBox:null,_backdrop:null},e=this;d=Qui.merge(d,a);var f=window.top.document,g=function(){var a;e.dialogBox=d._dialogBox=b('<div class="dialog-box '+d.dialogClass+'"></div>');var g=b('<div class="btn-close" title="关闭">×</div>'),h=b('<div class="title"><em>'+d.title+"</em></div>"),i=b('<div class="dialog-body"></div>');if(""!==d.iframeSrc?(d.htmlContent=a=b('<iframe class="iframe" frameborder="0" src="'+d.iframeSrc+(d.iframeSrc.indexOf("?")>0?"&":"?")+"t="+Qui.now()+'"></iframe>'),a.css({opacity:0}),i.addClass("dialog-loading"),a.on("load",function(){var c=a.contents(),f="CSS1Compat"==document.compatMode?c.find("html").get(0):c.find("body").get(0),g=f.scrollHeight,h=f.scrollWidth;a.height(g).width(h),e.reSize(),a.css({opacity:1}),i.removeClass("dialog-loading"),b.isFunction(d.openFn)&&d.openFn.call(e,c),b(".closeDialog",c).on("click",function(){e.close()})})):d.htmlContent=Qui.isObject(d.data)?c(d.content,d.data):d.content,""===d.htmlContent)return!1;if(d._backdrop=d.isMask?b('<div class="dialog-backdrop"></div>'):b(),d.width&&i.width(d.width),d.height&&i.height(d.height),d.hasClose&&d._dialogBox.append(g),""!=d.title&&d._dialogBox.append(h),d._dialogBox.append(i.append(d.htmlContent)),g.on("click",function(){e.close()}),b(".closeDialog",d._dialogBox).on("click",function(){e.close()}),b(".dialog-ajax-form",d._dialogBox).on("submit",function(){var a=b(this);return Qui.isFunction(d.submitFn)&&!1===d.submitFn.call(e,a)?!1:(b.ajax({url:a.attr("action"),type:"post",data:a.serializeArray(),dataType:"JSON"}).success(function(c){b.isFunction(d.submitSuccessFn)?d.submitSuccessFn.call(e,c):1==c.status?(location.href=c.toUrl||location.href,e.close()):a.find(".message-err").html(c.message).show()}).error(function(a){b.isFunction(d.submitErrorFn)&&d.submitErrorFn.call(e,a)}),!1)}),d.isIE6){var j=f.documentElement.clientHeight,k=f.body.clientHeight;d._dialogBox.css({position:"absolute",top:f.documentElement.scrollTop+.4*j}),d._backdrop.css({position:"absolute",width:"100%",height:j>k?j:k})}b("body",f).append(d._backdrop).append(d._dialogBox),d.follow?e.setPosition(d.follow):e.reSize(),""==d.iframeSrc&&b.isFunction(d.openFn)&&d.openFn.call(e,e)};if(e.setPosition=function(a){var c=b(a),e=d._dialogBox,f=0,g=0,h=document.body.scrollTop||document.documentElement.scrollTop,i=document.documentElement.clientHeight,j=document.documentElement.clientWidth,k=c.offset();f=h+i<e.outerHeight()+k.top?k.top-e.outerHeight():k.top+c.outerHeight(),g=j<e.outerWidth()+k.left?k.left+c.outerWidth()-e.outerWidth():k.left,e.css({position:"absolute",margin:0,top:f,left:g})},e.reSize=function(){var a=d._dialogBox,b=0,c=a.outerHeight();return d.isIE6?(b=a.find(".dialog-body").outerWidth(),a.css({width:b,"margin-left":0-b/2,"margin-top":0-c/2})):(b=a.outerWidth(),a.css({"margin-left":0-b/2,"margin-top":0-c/2})),a},e.close=function(){return d._dialogBox.remove(),d._backdrop.remove(),d.follow&&b(d.follow).data("dialogOpened",!1),b.isFunction(d.closeFn)&&d.closeFn.call(e,e),!1},d.follow){if(b(d.follow).data("dialogOpened"))return!1;g(),b(d.follow).data("dialogOpened",!0)}else g()};a.dialog=function(a){return new d(a||{})},a.$=b});